<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Member - Erg Room</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <header>
        <h1>Edit Member</h1>
    </header>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div class="flash {{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="photo large">
        {% if member.profile_picture %}
        <img src="/static/uploads/{{ member.profile_picture }}" alt="{{ member.name }}">
        {% else %}
        {{ member.name[0] }}
        {% endif %}
    </div>

    <form method="POST">
        <label for="name">Name</label>
        <input type="text" id="name" name="name" value="{{ member.name }}" required>

        <label for="rowing_category">Rowing Category</label>
        <select id="rowing_category" name="rowing_category" required>
            <option value="">Select Category</option>
            <option value="LM" {% if member.rowing_category == "LM" %}selected{% endif %}>LM (Lightweight)</option>
            <option value="M" {% if member.rowing_category == "M" %}selected{% endif %}>M (Heavyweight)</option>
            <option value="W" {% if member.rowing_category == "W" %}selected{% endif %}>W (Women)</option>
        </select>

        <label for="boat_class">Boat Class</label>
        <select id="boat_class" name="boat_class">
            <option value="">None</option>
            <option value="1V" {% if member.boat_class == "1V" %}selected{% endif %}>1V</option>
            <option value="2V" {% if member.boat_class == "2V" %}selected{% endif %}>2V</option>
            <option value="3V+" {% if member.boat_class == "3V+" %}selected{% endif %}>3V+</option>
        </select>

        <label for="passkey">Passkey (Optional)</label>
        <input type="text" id="passkey" name="passkey" value="{{ member.passkey or '' }}" placeholder="Custom login passkey">
        <p class="hint">Allows member to login with passkey instead of card ID</p>

        <label for="username">Username</label>
        <input type="text" id="username" name="username" value="{{ member.username or '' }}" placeholder="No username set">
        <p class="hint">{% if member.password_hash %}Account is set up{% else %}No account yet - user must sign in with card ID first{% endif %}</p>

        <label for="new_password">Reset Password (leave blank to keep current)</label>
        <input type="password" id="new_password" name="new_password" placeholder="Enter new password">

        <label for="uuid">UUID (Tag ID)</label>
        <input type="text" id="uuid" name="uuid" value="{{ member.id }}">
        <p class="hint">⚠️ Changing UUID requires re-registering the tag</p>

        <button type="submit">Save Changes</button>
    </form>

    <div class="danger">
        <form method="POST" action="/admin/member/{{ member.id }}/delete" onsubmit="return confirm('Delete this member?')">
            <button type="submit" class="btn-danger">Delete Member</button>
        </form>
    </div>

    <footer>
        <a href="/admin">← Back to Admin</a>
    </footer>
</body>
</html>
